<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--favicon-->
    <link rel="apple-touch-icon" sizes="57x57" href="{% static 'images/apple-icon-57x57.png' %}">
    <link rel="apple-touch-icon" sizes="60x60" href="{% static 'images/apple-icon-60x60.png' %}">
    <link rel="apple-touch-icon" sizes="72x72" href="{% static 'images/apple-icon-72x72.png' %}">
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'images/apple-icon-76x76.png' %}">
    <link rel="apple-touch-icon" sizes="114x114" href="{% static 'images/apple-icon-114x114.png' %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'images/apple-icon-120x120.png' %}">
    <link rel="apple-touch-icon" sizes="144x144" href="{% static 'images/apple-icon-144x144.png' %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'images/apple-icon-152x152.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-icon-180x180.png' %}">
    <link rel="icon" type="image/png" sizes="192x192"  href="{% static 'images/android-icon-192x192.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="96x96" href="{% static 'images/favicon-96x96.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'images/manifest.json' %}">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="{% static 'images/ms-icon-144x144.png' %}">
    <meta name="theme-color" content="#ffffff">

    <title>{% block title %}{% endblock %}</title>

    <!--scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <!-- <script src="{% static 'scripts/hug.js' %}" type="text/javascript"></script> -->

    <!--fonts -->
    <link href="https://fonts.googleapis.com/css?family=Mate|Montserrat|Old+Standard+TT" rel="stylesheet">

    <!--stylesheets -->
    <link href="{% static 'css/header.css' %}" rel="stylesheet">
    <link href="{% static 'css/modal.css' %}" rel="stylesheet">
    <link href="{% static 'css/navbar.css' %}" rel="stylesheet">
    {% block styles %}{% endblock %}

</head>

<body>
<header><a class="brand" href="/"><img alt="brand" src="{%  static 'images/logo.png' %}"></a></header>

<!--Main Body of Text-->
{% block body_block %}{% endblock %}

<!-- Register Modal -->
<div id="registerModal" class="modal">
    <div class="modal-content">
        <span id="registerModalClose" class="close">&times</span>
        <div class="container-form">
            <form id="registerForm" method="POST">
                {% csrf_token %}
                <p id="message" class="required-message">Please fill in <br/> the missing fields</p>
                <p id="email-wrong" class="required-message">Please use a valid email address</p>
                <p id="password-not-matching" class="required-message">Passwords do not match</p>

                <label for="username">Username</label>
                <input type="text" id="username" name="username">
                <label for="fname">First Name</label>
                <input type="text" id="fname" name="fname">
                <label for="lname">Last Name</label>
                <input type="text" id="lname" name="lname">
                <label for="email">Email</label>
                <input type="text" id="email" name="email">
                <label for="password">Password</label>
                <input type="password" id="password" name="password">
                <label for="rpassword">Retype Password</label>
                <input type="password" id="rpassword" name="rpassword">
                <a id="registerButton" class="modalButton">Register</a>
            </form>
        </div>
    </div>
</div>



<!-- Login Modal -->
<div id="loginModal" class="modal">
    <div id="loginModalContent" class="modal-content">
        <span id="loginModalClose" class="close">&times;</span>
        <div class="container-form">
            <form id="loginForm">
                <label for="email">Email</label>
                <input type="text" id="login-email" name="email">
                <label for="password">Password</label>
                <input type="password" id="login-password" name="password">
                <button class="modalButton" type="submit" value="Submit">Login</button>
            </form>
        </div>
    </div>
</div>


<!-- Thank you Modal -->
<div id="thankYouModal" class="modal">
    <div class="modal-content">
        <span id="thankYouModalClose" class="close">&times;</span>
        <div class="container-form">
            <p class="thank-you">Thank you</br>for</br>registering</p>
            <img class="thank-you" alt="heart" src="{%  static 'images/heart-full.png' %}">
            <p class="thank-you">Now you can</br>save your</br>favorite</br>trees</p>
        </div>
    </div>
</div>


<footer><p class="copyright">Â© 2018 Alexis Jensen and Curtis Moody</p></footer>

<!--Navbar -->
<nav class="navbar">
    <div class="navlinks">
        <a href="{% url 'about' %}">About</a>
        <!--Remove link after login functionality works -->
        <a href="{% url 'favourites' %}">Favourites</a>
        {#        Uncomment once implemention complete#}
        {#                              {% if user.is_authenticated %}#}
        {#                                    <li><a href="{% url 'favourites' %}" class="fav">my favourites</a></li>#}
        {#                                    <li><a href="{% url 'logout' %}">logout</a></li>#}
        {##}
        {##}
        {#                                {% else %}#}
        {#                                    <li><a href="{% url 'register' %}">register</a></li>#}
        {#                                    <li><a href="{% url 'login' %}">login</a></li>#}
        {#                                {% endif %}#}

        <!-- Real links place up above after it is working -->
        <a id="registerLink" href="/">register</a>
        <a id="loginLink" href="/">login</a>
    </div>
</nav>


<!-- Modal Scripts -->
<script>
    //  **** Register Modal Functionality ***** //
    // Variables for register modal
    var registerLink = document.getElementById("registerLink");
    var registerModal = document.getElementById('registerModal');
    var registerButton = document.getElementById('registerButton');
    var registerX = document.getElementById('registerModalClose');
    var registerForm = document.getElementById('registerForm');
    var requiredMessage = document.getElementById('message');
    var emailMessage = document.getElementById('email-wrong');
    var passwordMessage = document.getElementById('password-not-matching');
    var registerLoginSuccess = false;

    // Register Form Variables
    var $username = $("#username");
    var $fname = $("#fname");
    var $lname = $("#lname");
    var $email = $("#email");
    var $password = $("#password");
    var $rpassword = $("#rpassword");
    var $contactFormRequired = [$username, $fname, $lname, $email,
        $password, $rpassword];

    function validateEmail(email) {
        var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    }

    function resetRegisterModal(form, formfields, blanksMessage, emailMessage, passwordMessage) {
        blanksMessage.style.display = "none";
        emailMessage.style.display = "none";
        passwordMessage.style.display = "none";
        form.reset();
        //return style colour to original colour (if it has been altered by invalid styles)
        for(var i = 0; i < formfields.length; i++) {
            var reqField = formfields[i];
            var reqFieldIDName = reqField.attr('id');
            $("label[for='"+reqFieldIDName+"']").css("color", "#5A634D");
            reqField.css("border-bottom", "1px solid #5A634D");
        }
    }

    // When the user clicks register link in navbar, open register modal
    registerLink.onclick = function(event) {
        event.preventDefault();
        if (loginModal.style.display === "block"){loginModal.style.display = "none";}
        resetRegisterModal(registerForm, $contactFormRequired, requiredMessage, emailMessage, passwordMessage);
        registerModal.style.display = "block";
    }

    // When the user clicks on (x), close the register modal
    registerX.onclick = function() {
        registerModal.style.display = "none";
    };

    // When the user hits the register button at then end of form
    $(document).ready(function () {

        registerButton.onclick = function() {
            var form = $('#registerForm');

            // Turn all missing fields label and border to pink
            for(var i = 0; i < $contactFormRequired.length; i++) {
                var reqFieldValue = $contactFormRequired[i].val();
                var reqField = $contactFormRequired[i];
                var reqFieldIDName = reqField.attr('id');

                if (reqFieldValue.length === 0) {
                    event.preventDefault();
                    requiredMessage.style.display = "block";
                    $("label[for='"+reqFieldIDName+"']").css("color", "#FE7460");
                    reqField.css("border-bottom", "1px solid #FE7460");
                    reqField.focus(function () {
                        var name = $(this).attr('id');
                        $("label[for='"+name+"']").css("color", "#5A634D");
                        $(this).css("color", "#5A634D");
                        $(this).css("border-bottom", "1px solid #5A634D");
                    });
                } else {
                    registerLoginSuccess = true;
                    requiredMessage.style.display = "none";
                    $("label[for='"+reqFieldIDName+"']").css("color", "#5A634D");
                    reqField.css("border-bottom", "1px solid #5A634D");
                }

            } //close for loop

            // if email is invalid turn email field to pink
            if (!validateEmail($email.val())){
                event.preventDefault();
                registerLoginSuccess = false;
                emailMessage.style.display = "block";
                $email.css("color", "#FE7460");
                $email.focus(function () {
                    var name = $(this).attr('id');
                    $("label[for='"+name+"']").css("color", "#5A634D");
                    $(this).css("color", "#5A634D");
                    $(this).css("border-bottom", "1px solid #5A634D");
                });
                $("label[for='"+$email.attr('id')+"']").css("color", "#FE7460");
                $email.css("border-bottom", "1px solid #FE7460");
            } else {
                emailMessage.style.display = "none";
                registerLoginSuccess = true;
            }

            //If password fields do not match turn them to pink
            if ($password.val() !== $rpassword.val()){
                event.preventDefault();
                registerLoginSuccess = false;
                passwordMessage.style.display = "block";
                $password.css("color", "#FE7460");
                $("label[for='"+$password.attr('id')+"']").css("color", "#FE7460");
                $password.css("border-bottom", "1px solid #FE7460");
                $password.focus(function () {
                    $(this).val('');
                    var name = $(this).attr('id');
                    $("label[for='"+name+"']").css("color", "#5A634D");
                    $(this).css("color", "#5A634D");
                    $(this).css("border-bottom", "1px solid #5A634D");
                });
                $rpassword.css("color", "#FE7460");
                $rpassword.focus(function () {
                    var name = $(this).attr('id');
                    $(this).val('');
                    $("label[for='"+name+"']").css("color", "#5A634D");
                    $(this).css("color", "#5A634D");
                    $(this).css("border-bottom", "1px solid #5A634D");
                });
                $("label[for='"+$rpassword.attr('id')+"']").css("color", "#FE7460");
                $rpassword.css("border-bottom", "1px solid #FE7460");
            } else {
                passwordMessage.style.display = "none";
                registerLoginSuccess = true;
            }

            // If all fields are valid register user into database
            if (registerLoginSuccess) {
                $.ajax({
                    url: "{% url 'register' %}",
                    type: 'post',
                    data: form.serialize(),
                    error: function(xhr, ajaxOptions, thrownError){ alert(thrownError); },
                    success: function(data){

                        if (data['status'] == 'success') {
                            $('#registerModal').hide();
                            $('#thankYouModal').show();
                        }
                    }
                }); // close for ajax
            } //closing if statement
        } //close for registerButtonOnClick
    });// close for document.ready



    //  **** Login Modal Functionality ***** //

    // Variables for login modal
    var loginLink = document.getElementById("loginLink");
    var loginModal = document.getElementById('loginModal');
    var loginModalContent = document.getElementById('loginModalContent');
    var loginForm = document.getElementById('loginForm');
    var loginX = document.getElementById('loginModalClose');


    // When the user clicks login link in navbar, open login modal
    loginLink.onclick = function(event) {
        event.preventDefault();
        if (registerModal.style.display === "block"){registerModal.style.display = "none";}
        loginModal.style.display = "block";
        loginForm.reset();
        loginModalContent.style.height = "360px";
    }

    // When the user clicks on (x), close the login modal
    // and reset to untouched modal
    loginX.onclick = function() {
        loginModal.style.display = "none";
    };



    //  **** Thank You Modal Functionality ***** //

    // Variables for thank you modal
    var thankYouModal = document.getElementById('thankYouModal');
    var thankYouX = document.getElementById('thankYouModalClose');

    thankYouX.onclick = function() {
        thankYouModal.style.display = "none";
    }





</script>

</body>
</html>